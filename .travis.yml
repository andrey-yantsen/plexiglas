language: python

cache: pip

stages:
  - test
  - name: deploy
    if: tag IS present

jobs:
  include:
    - python: 2.7
    - python: 3.6
    - stage: deploy
      python: 3.6
      script: true
      deploy:
        - provider: pypi
          user: andrey_yantsen
          password: $PYPI_PASSWORD
          on:
            tags: true
            distributions: sdist bdist_wheel
            repo: andrey-yantsen/plexiglas
        - provider: releases
          api_key: $GITHUB_OAUTH_TOKEN
          skip_cleanup: true
          file_glob: true
          file: "dist/*"
          prerelease: true
          on:
            tags: true
            repo: andrey-yantsen/plexiglas
